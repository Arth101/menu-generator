<!DOCTYPE html>
<html>
  <head>
    <!--Import Google Fonts-->
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,500,700,900' rel='stylesheet' type='text/css'>
    <!--Import CSS-->
    <link type="text/css" rel="stylesheet" href="styles/css/style.css" />

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>menu-gen</title>
    <meta charset="UTF-8">
  </head>

  <body>
    <main>
    <nav>
      <a href="/"><span class="logo">BRAND4U</span></a>
    </nav>
    <div class="container">
      <form action="next.html" method="GET">
        <div class="row">
          <div class="col"><h3>General:</h3></div>
          <div class="col">
            <input class="menu-brand" type="text" placeholder="Storename" name="storename" />
          </div>
          <div class="col margin-bottom">
            <input class="menu-align" type="radio" name="storenameAlign" value="left" checked> Left align <input type="radio" name="storenameAlign" value="center"> Center
          </div>
          <div class="col"><h3>Menu:</h3></div>
          <div class="menu-items">
          <div class="menu-item row new js-fade fade-in">
            <div class="container-name">
                <input class="item-name" id="newInput" type="text" placeholder="fx Ribeye steak" name="name" />
                <input class="item-description" type="text" placeholder="fx Classic Ribeye steak served with fries and salad" name="description" />
            </div>
            <div class="container-price">
              <input class="item-price" type="number" min="0" step="0.01" placeholder="fx 179" name="price" />
            </div>
          </div>
        </div>
          <div

            <div class="col">
              <button class="submit-btn" type="submit" value="submit">submit</button>
            </div>

      </div>
    </form>
    <form class="hidden" id="hiddenform" action="save" method="POST">
      <input id="hidden" name="viewModel" value="plz" />
    </form>
    </div>
    <div class="alertContainer"></div>
  </main>
  <footer>
    © 2016 Anders Enghøj, All rights reserved.
  </footer>
    <script>
    document.querySelector("#newInput").addEventListener("focus", createNewNodes);

      function createNewNodes(){
        console.log("pllz");
        document.querySelector("#newInput").removeEventListener("focus", createNewNodes);
        var inputs = document.querySelector(".new");
        var cln = inputs.cloneNode(true);
        console.log(cln);
        var clonedInputs = document.getElementsByTagName('input');
        console.log(e);

        document.querySelector(".new").className = document.querySelector(".new").className.replace( /(?:^|\s)new(?!\S)/g , '' );
        document.querySelector(".menu-items").appendChild(cln);
        document.querySelector("#newInput").removeAttribute("id");
        document.querySelector("#newInput").addEventListener("focus", createNewNodes);



        var elements = document.querySelectorAll(".new input");
        console.log("long:", elements.length);
        for (var i = 0, element; element = elements[i++];) {
          var e = document.querySelectorAll("input").length + i;
          element.setAttribute("name", "horse" + e);
          console.log("it's an empty textfield");
        }
      }

      document.querySelector(".submit-btn").addEventListener("click", function(e) {
        e.preventDefault();
        console.log("prevented!");
        var viewModel = {};
        var menuItems  = [];

        var menuBrand = document.querySelector(".menu-brand").value;
        viewModel["storename"] = menuBrand;
        var menuAlign = document.querySelector('input[name="storenameAlign"]:checked').value;
        viewModel["storenameAlign"] = menuAlign;

        var inputs = document.querySelectorAll(".menu-item");
        Array.prototype.forEach.call(inputs, function(input) {
          var obj = {};
          var itemName = input.querySelector(".item-name").value;
          if(itemName == ""){
            return;
          };
          var itemDescription = input.querySelector(".item-description").value;
          var itemPrice = input.querySelector(".item-price").value;
          if(itemPrice == ""){
            itemPrice = "0";
          };
          obj["name"] = itemName;
          obj["description"] = itemDescription;
          obj["price"] = itemPrice;
          menuItems.push(obj);
          console.log("works");
        });
        if(menuItems.length == 0){
          console.log("please write some shit");
          var alert = '<div class="alert">Please fill in something</div>';
          document.querySelector(".alertContainer").innerHTML += alert;
          return true;
        };
        viewModel["menuItems"] = menuItems;
        console.log(JSON.stringify(viewModel));
        document.querySelector("#hidden").value = JSON.stringify(viewModel);
        document.querySelector("#hiddenform").submit();
        return false;
    });
    </script>
  </body>
</html>
